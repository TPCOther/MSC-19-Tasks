# 一个从重庆大学教务网获取课程表并以json格式存储的程序
郭俊余的 Task8，以 BASH 和 Python3 编写。

能够保存登陆的 cookies，能够尝试使用之前登陆使用过的 cookies。能够读取简陋的存储用户名和/或密码的“配置文件”，也能够运行时询问用户。

本程序在 GPLv3 下。

## 闲话
受空闲时间和自身水平所限，目前也只搞到了生成 json 文件，而且是通过似乎有点奇怪的方法（因为时间短，所以用了最熟悉的办法……bash 脚本负责与教务网和用户交互，以及数据预处理，Python3 仅负责用前面的处理结果生成 json），也没有考虑太多{健壮,容错,易用}性。虽然我感觉到此最大的困难已经解决了，但是我真的没有时间继续搞了。或许明天（其实也是今天了）还能实现一些东东，但是今晚（其实也是今天凌晨了）还是先提交 PR 为敬。

<p align="right">——2019/11/10 01:50</p>

## 一个疑惑
在[getScheme.sh](getScheme.sh)第 47 行我不知道为什么用了`eval`最后会多个参数，而且这个参数是回车符（\r）！我感觉有点诡异……

而将`eval`改为`echo`，输出看起来一切正常，并无法看到什么能导致这个回车符产生的东西。
## “配置文件”
路径就是[config](config)，以 bash 的语法定义两个变量`user`和`password`，含义不言而喻。
## 生成的 json 文件结构
### 示例
```
{
    "[MATH10113]": {
        "name": "数学分析（1）",
        "credit": 4.0,
        "hours": 72.0,
        "teachingHours": 72.0,
        "practicalHours": 0.0,
        "type": "专业基础必修",
        "mode": "理论",
        "appraisal": "考试",
        "detail": [
            {
                "teacher": "何传江",
                "week": "6-17",
                "day": "一",
                "class": "1-2",
                "place": "DYC103"
            },
            {
                "teacher": "何传江",
                "week": "6-17",
                "day": "三",
                "class": "1-2",
                "place": "DYC103"
            },
            {
                "teacher": "何传江",
                "week": "6-17",
                "day": "五",
                "class": "5-6",
                "place": "DYC103"
            }
        ]
    },...
}
```
### 含义
生成的 json 中是以课程的编号（如上面的`[MATH10113]`）为键，相对应的值是储存对应课程数据的对象。

每个课程的对象：

| 键 | 值 | 数据类型（若该值在教务网的课表上无，则类型是`null`） |
|----|----|----------|
| `name` | 课程名称 | 字符串 |
| `credit` | 总学分 | 浮点数 |
| `hours` | 总学时 | 浮点数 |
| `teachingHours` | 讲授学时 | 浮点数 |
| `practicalHours` | 上机学时（但我更倾向于“实践学时”） | 浮点数 |
| `type` | 课程类别 | 字符串 |
| `mode` | 授课方式 | 字符串 |
| `appraisal` | 考核方式 | 字符串 |
| `detail` | 课程时间、地点、人物（教师。逃……） | 数组 |

`detail`键对应的数组中以时间顺序包含了若干对象，对应的不同的老师、时间和/或地点。

这些对象结构如下：

| 键 | 值 | 数据类型（为`null`的情况同上） |
|----|----|--------------------------------|
| `teacher` | 教师姓名 | 字符串 |
| `week` | 周次 | 字符串 |
| `day` | 星期 | 字符串 |
| `class` | 节次 | 字符串 |
| `place` | 地点 | 字符串 |

值得一提的是，我这儿思修课的“期末考试”中，地点就写了“期末考试”。我没有对此做任何特殊处理。

## 依赖
- bash
- curl
- sed
- python3
- iconv
